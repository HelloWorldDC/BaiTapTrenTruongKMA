# Giải thích thuật toán mở rộng khóa AES (Key Expansion)
### Ví dụ
***Input***: 
- Khóa K = 36 8a c0 f4 ed cf 76 a6 08 a3 b6 78 31 31 27 6e
- Nk = 4
- Bốn từ đầu tiên: w[0] = 368ac0f4, w[1]=edcf76a6, w[2]=08a3b678, w[3]=3131276e (Được lấy từ Khóa K, mỗi từ 4 byte)

***Output***:
- Tính w[i] (4 $\leq$ i $\leq$ 43)

### Bảng diễn giải thuật toán
| i | temp | After RotWord | After SubWord | Rcon[i/Nk] | After XOR with Rcon | w[i] = temp $\oplus$ w[i - Nk] |
| --- | --- | :---: | :---: | :---: | :---: | :---: |
| 4 | 3131276e | 31276e31 | c7cc9fc7 | 01000000 | c6cc9fc7 | f0465f33 |
| 5 | f0465f33 |  |  |  |  | 1d892995 |
| 6 | 1d892995 |  |  |  |  | 152a9fed |
| 7 | 152a9fed |  |  |  |  | 241bb883 |
| 8 | 241bb883 | 1bb88324 | af6cec36 | 02000000 | ad6cec36 | 5d2ab305 |

### Giải thích các phép toán
- **Phép toán RotWord**: Là phép dịch byte sang trái 1 lần, ở i thứ 4 ta có temp = 31***31***276e, sau khi thực hiện phép toán RotWord ta có kết quả là  ***31***276e31
- **Phép toán SubWord**: Là phép tham chiếu đến bảng [S-Box](#Bảng-SBox), ví dụ ở i thứ 4 sau khi thực hiện phép RotWord ta tham chiếu byte đầu tiên là `31` ta sẽ tìm đến ***hàng 3*** ***cột 1*** của bảng S-Box sẽ có kết quả là `c7`
- **Rcon**: [Rcon](#Bảng-Rcon) là 1 bảng ta có thể tham chiếu đến mà không cần phải tính toán lại, `i/Nk` là phần tử được tham chiếu đến
- **XOR with Rcon**: Là phép toán lấy kết quả của phép ***SubWord*** XOR với ***Rcon***
- **w[i]**: Là phép toán lấy kết quả của ***temp*** XOR với w thứ ***i - Nk***

***Lưu ý***: Vì Nk = 4 nên ở i thứ 4, thứ 8, thứ 12, v..v.., w[i] sẽ lấy kết quả của phép toán ***XOR with Rcon*** XOR với ***w[i - Nk]*** thay vì phải dùng kết quả của **temp**

### Bảng Rcon
| i | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Rcon[i] | 01000000 | 02000000 | 04000000 | 08000000 | 10000000 | 20000000 | 40000000 | 80000000 | 1b000000 | 36000000 |

<details><summary>Copy bảng Rcon</summary>
<p>

```
01000000, 02000000, 04000000, 08000000, 10000000, 20000000, 40000000, 80000000, 1b000000, 36000000
```

</p>
</details>

### Bảng SBox
|   | 0  | 1  | 2  | 3  | 4  | 5  | 6  | 7  | 8  | 9  | a  | b  | c  | d  | e  | f  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| **0** | 63 | 7c | 77 | 7b | f2 | 6b | 6f | c5 | 30 | 01 | 67 | 2b | fe | d7 | ab | 76 |  
| **1** | ca | 82 | c9 | 7d | fa | 59 | 47 | f0 | ad | d4 | a2 | af | 9c | a4 | 72 | c0 |  
| **2** | b7 | fd | 93 | 26 | 36 | 3f | f7 | cc | 34 | a5 | e5 | f1 | 71 | d8 | 31 | 15 |  
| **3** | 04 | c7 | 23 | c3 | 18 | 96 | 05 | 9a | 07 | 12 | 80 | e2 | eb | 27 | b2 | 75 |  
| **4** | 09 | 83 | 2c | 1a | 1b | 6e | 5a | a0 | 52 | 3b | d6 | b3 | 29 | e3 | 2f | 84 |  
| **5** | 53 | d1 | 00 | ed | 20 | fc | b1 | 5b | 6a | cb | be | 39 | 4a | 4c | 58 | cf |  
| **6** | d0 | ef | aa | fb | 43 | 4d | 33 | 85 | 45 | f9 | 02 | 7f | 50 | 3c | 9f | a8 |  
| **7** | 51 | a3 | 40 | 8f | 92 | 9d | 38 | f5 | bc | b6 | da | 21 | 10 | ff | f3 | d2 |  
| **8** | cd | 0c | 13 | ec | 5f | 97 | 44 | 17 | c4 | a7 | 7e | 3d | 64 | 5d | 19 | 73 |  
| **9** | 60 | 81 | 4f | dc | 22 | 2a | 90 | 88 | 46 | ee | b8 | 14 | de | 5e | 0b | db |  
| **a** | e0 | 32 | 3a | 0a | 49 | 06 | 24 | 5c | c2 | d3 | ac | 62 | 91 | 95 | e4 | 79 | 
| **b** | e7 | c8 | 37 | 6d | 8d | d5 | 4e | a9 | 6c | 56 | f4 | ea | 65 | 7a | ae | 08 | 
| **c** | ba | 78 | 25 | 2e | 1c | a6 | b4 | c6 | e8 | dd | 74 | 1f | 4b | bd | 8b | 8a | 
| **d** | 70 | 3e | b5 | 66 | 48 | 03 | f6 | 0e | 61 | 35 | 57 | b9 | 86 | c1 | 1d | 9e | 
| **e** | e1 | f8 | 98 | 11 | 69 | d9 | 8e | 94 | 9b | 1e | 87 | e9 | ce | 55 | 28 | df | 
| **f** | 8c | a1 | 89 | 0d | bf | e6 | 42 | 68 | 41 | 99 | 2d | 0f | b0 | 54 | bb | 16 |

<details><summary>Copy bảng S-Box</summary>
<p>

```
"63","7c","77","7b","f2","6b","6f","c5","30","01","67","2b","fe","d7","ab","76",
"ca","82","c9","7d","fa","59","47","f0","ad","d4","a2","af","9c","a4","72","c0",
"b7","fd","93","26","36","3f","f7","cc","34","a5","e5","f1","71","d8","31","15",
"04","c7","23","c3","18","96","05","9a","07","12","80","e2","eb","27","b2","75",
"09","83","2c","1a","1b","6e","5a","a0","52","3b","d6","b3","29","e3","2f","84",
"53","d1","00","ed","20","fc","b1","5b","6a","cb","be","39","4a","4c","58","cf",
"d0","ef","aa","fb","43","4d","33","85","45","f9","02","7f","50","3c","9f","a8",
"51","a3","40","8f","92","9d","38","f5","bc","b6","da","21","10","ff","f3","d2",
"cd","0c","13","ec","5f","97","44","17","c4","a7","7e","3d","64","5d","19","73",
"60","81","4f","dc","22","2a","90","88","46","ee","b8","14","de","5e","0b","db",
"e0","32","3a","0a","49","06","24","5c","c2","d3","ac","62","91","95","e4","79",
"e7","c8","37","6d","8d","d5","4e","a9","6c","56","f4","ea","65","7a","ae","08",
"ba","78","25","2e","1c","a6","b4","c6","e8","dd","74","1f","4b","bd","8b","8a",
"70","3e","b5","66","48","03","f6","0e","61","35","57","b9","86","c1","1d","9e",
"e1","f8","98","11","69","d9","8e","94","9b","1e","87","e9","ce","55","28","df",
"8c","a1","89","0d","bf","e6","42","68","41","99","2d","0f","b0","54","bb","16",
```

</p>
</details>
